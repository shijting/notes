# 简要需求分析

正常来说，如果你工作在国内的互联网公司，那么你收到的需求描述都是非常粗略的。
所以你要掌握快速需求分析的小技巧，主要有三点:
- 参考竞品。应该说大部分互联网的功能都是你抄我我抄你的，所以你基本上可以参考竞品

  一个业务场景的具体流程，包括如何处理异常的流程（就是你故意搞乱）

- 从不同角度分析:
	- 功能角度: 功能角度也就是明确我们做到哪些功能，有没有轻重缓急之分，一个具体的功能要做到什么程度。
	
	- 非功能角度: 对于中小型公司来说，按照这个顺序去思考  **安全性 > 扩展性 > 性能**。第一个保证你的系统不会被人恶意搞崩，第二个是有限度应对将来的需求变更，第三个是优化用户体验。
	
	  如何想可以一边摸鱼一边上班就要把扩展性做好，做功能的时候可以预留一些后面可能会用到的接口（**前瞻性设计**）
	
- 从正常和异常流程两个角度思考:注意区分业务异常流程和技术异常流程。
注意，如果你的产品经理很称职，你问产品经理就可以。只有在产品经理不称职的情况下，你才需要花费比较多的功夫来分析需求。



### 参考竞品
以我们这个验证码登录功能为例，你可以看不同公司的验证码登录的实现。
而后你就需要总结他们的功能特性:

- 大部分公司，在你发送手机验证码之前，都要求你先验证一下，比如说利用拼图，这一步你可以猜测是防止有人恶意触发发送短信。
- 大部分公司，在你发送了一个验证码之后，都不能连续发送，要隔一段时间。
- 大部分公司，在手机号码第一次使用的时候，直接会帮你注册一个账号。
- 大部分公司，手机验证码都有有效期。
- 大部分公司，你访问不同服务，手机验证码都是独立的，例如你在 A 功能上触发了手机验证码，在 B功能上可以立刻触发再次发送验证码。
- **验证码只能使用一次**，也就是验证码校验通过之后，这个验证码将无法再次使用。



### 从功能和非功能的角度分析
在功能上，整个需求可以简单描述为:

- 允许用户使用手机号码接受验证码登录。在登录的时候，如果手机号码是一个全新的手机号码，那么直接注册一个新的账号。
- 手机验证码的有效期是 10 分钟
- 用户一分钟内只能发送一次验证码
- 用户登录/注册成功之后跳转到首页

在非功能上: 保护系统，**防止攻击者恶意发送短信**



### 深入分析
接下来你要站在个系统设计的角度去分析，怎么实现这个功能。
“手机验证码登录”讨论了两个事情，一个是验证码一个是登录。这两个是强耦合的吗?

也就是，**别的业务有可能用手机验证码吗?** （修改密码，登录，危险操作二次验证）

所以，手机验证码应该是一个**独立的功能**。
如果是模块，那么它是一个**独立的模块**。
如果是微服务，那么它是一个独立的微服务。

### 手机验证码功能

进一步你会发现，手机验证码要通过短信来发送那么短信是不是也会被别的业务使用?

在把它做成一个独立的功能之后，你要进一步想:

**短信这个东西，有没有可能换供应商?**
比如说今天买了腾讯的短信，明天买了阿里的短信，后天买了不知道谁的短信。

### 综合考虑


综合考虑，你会发现你有两个变化点
- 不同业务都要用短信功能和验证码功能
- 可能换供应商

所以你就要想，我现在该怎么留出一点点扩展的空间，保证万一后面新的业务要用验证码，我这边不动，或者说少动。万一要是换了供应商，我这边也可以少动或者不动。


### 服务划分

你也可以理解为模块划分
所以你需要

- **一个独立的短信发送服务**
- 在独立的短信发送服务的基础上，**封装一个验证码功能。**
- 在验证码功能的基础上，**封装一个登录功能。**
这就是业务上的**超前半步设计**，也叫做**叠床架屋**


### 以特定供应商的短信 API 开始
在大部分业务的初期，你是知道有什么地方有扩展但不知道将来会怎么扩展。所以你只需要考虑当下的需求，然后做一个简单的抽象，**预留出接口**就可以。
**你不能指望，你能够设计一个接口，用上几十年，适配所有的需求变化，这是不现实的。**

所以这里我们就选定腾讯的短信服务，来试着抽象一个接口。

